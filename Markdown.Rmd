---
title: "Marketing Data mart Manual"
author: "Group 2"
date: "01/08/2020"
output:
  html_document:
    df_print: paged
  word_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(comment = NA)
```

```{r,warning = FALSE,message=FALSE,echo=FALSE}
if(!require("dplyr")) install.packages("dplyr");
library(dplyr)

if(!require("ggplot2")) install.packages("ggplot2"); library("ggplot2")

if(!require("tidyverse")) install.packages("tidyverse");
library(tidyverse)

if(!require("rworldmap")) install.packages("rworldmap");
library(rworldmap)

if(!require("rworldxtra")) install.packages("rworldxtra");
library(rworldxtra)

if(!require("RColorBrewer")) install.packages("RColorBrewer");
library(RColorBrewer)
library(readr)
library(scales)

```


```{r,include=FALSE}
data <- read.csv("MarketingDatamart.csv")
Code<-read.csv("CountryManual.csv")
data<-merge(x=data,y=Code,by="Country")

```

# Introduction
***
The Marketing data mart is created using the raw and analytic datasets from the *Division on Addictions (DOA)* and *bwin Interactive Entertainment*, *AG (bwin)*, an Internet betting service provider headquartered in Vienna, Austria.

This Marketing Data mart defines variables and **key Metrics** for a user.  



### Bwin Interactive Entertainment

BWin Interactive Entertainment is an online gambling company which offers different kind of products and services like: Sports betting, Poker games, Casino games, among others.

The datasets provide evidence from the first eight months of the first prospective longitudinal, real-time, Internet sports betting behavior study that took place from February 1, 2005 through September 30, 2005.


### Customers description

BWin has 42649 gamblers from all around the world; being Europe the region with more gamblers. The country with the most number of clients is Germany and there is an important difference between the number of customers in this country and the rest of the countries, most countries have less than 250 customers.


## Key Metrics
***
### GGR
**Gross Gaming Revenue** is a true measure of the economic value of gambling. GGR is the figure used to determine what a casino or other gaming operation earns before taxes, salaries and other expenses are paid.  

GGR = TotalStakes - TotalWinnings


### ARPU
**Average Revenue per User** is a measure of the revenue generated by one player per unit time.  

ARPU = TotalStakes/TotalActivedays


### DepositPerBet
**Deposit/Bet ratio** shows you the average deposit per each bet.  

DepositPerBet = TotalStakes/TotalBets


### ChurnRate
**Churn rate (or attrition rate)** is a possible indicator of the chance of a user to leave during a given period of time.  

ChurnRate = (DaysSinceActive/241) multiplied by 100


### LoyaltyCategory
**Loyalty Category** is a categorical metric used to group the users based on ChurnRate and TotalActiveDays.    

VIP -- (ChurnRate < 20 & TotalActivedays > 110)          
Elite -- (ChurnRate < 65 & TotalActivedays > 50)          
Normal -- Others       

# Analysis
***
### Customer Base
```{r , warning=FALSE, message=FALSE, echo=FALSE,include=FALSE}
continents <- data%>%
  count(Code,Country)
x <- seq(1,2500,by=250)
y<-c(x,24171)
sPDF <- joinCountryData2Map(continents, joinCode = "UN", nameJoinColumn = "Code")
```

```{r, warning=FALSE, message=FALSE, echo=FALSE}
par(mai=c(0,0,0.2,0),xaxs="i",yaxs="i")
colourPalette <- brewer.pal(10,'YlGn')
mapParams<- mapCountryData(sPDF, nameColumnToPlot="n", mapTitle="Users by Country",numCats = length((continents$Country)), catMethod= y,colourPalette=colourPalette, addLegend=FALSE)
do.call( addMapLegend, c( mapParams
                          , legendLabels="all"                          , legendWidth=0.5,legendIntervals='page'))
```

### TOP 10 Countries with Highest Users
The Top 10 Countries with most number of Gamblers

```{r, warnings = FALSE, echo=FALSE}

MD4 <- data %>% group_by(Country) %>% count(Country) %>% rename(Counts = n) %>% 
  arrange(desc(Counts)) 

MD4 <- MD4[1:10,]

ggplot(MD4, aes(x = reorder(Country, Counts), y=Counts)) + 
  geom_bar(stat = "identity", fill="#f68060", alpha=.6, width=.4) + labs(title ="", x = "Country", y = "Users") +
  coord_flip()


```

### Age Analysis
 
Regarding age distribution, customers are between the range of ages from 14 to 105 years old, the highest concentration of customers are 24 years old. The average age is 31 years old.

```{r, warning = FALSE, echo = FALSE}
age_counts<-data%>%
  count(Age, sort=TRUE)
top_5<-age_counts[c(1:5),]

top_5 <- data.frame(top_5)
print(summary(data$Age))

ggplot(data, aes(x=Age)) + geom_area(stat = "bin", bins = 30, fill = "lightblue") + scale_x_continuous(breaks = seq(0,100,10))+ labs(title = "Customers Age Distribution", x = "", y = "Count") + geom_vline(aes(xintercept=mean(Age,na.rm=TRUE)),
            color="blue", linetype="dashed", size=1)

```


Women are not very representative in BWin's gamblers, since only around 8% of customers are women.

```{r, warning = FALSE, echo = FALSE}
data_gen<-data[is.na(data$Gender) == FALSE, ]
summary_gender<-data_gen%>%
  group_by(Gender) %>%
  summarise(n = n()) %>%
  mutate(percentage  = (n / sum(n))*100) %>%
  rename(Count = n)

su <- data.frame(summary_gender)
print(su)

```


### Number of Users by Product
The below graph shows the number of users by product. There is a remarkable preference by the product Sports book fixed-odd.

```{r fig.height=5, fig.width=8, message=FALSE, warning=FALSE,echo=FALSE}
dataFP<-data[is.na(data$FavProduct) == FALSE, ]
prodfav<-dataFP%>%
  count(FavProduct,sort=TRUE)

ggplot(prodfav, aes(x=reorder(FavProduct, n),y=n)) + geom_bar(stat='identity',fill = 'dodgerblue3') + theme_bw() + coord_flip() + scale_y_continuous("Nbr Users", breaks = seq(0,43000,6000)) + labs(title = "Users by Product",x="") + theme_gray() + geom_text(aes(label=n), position=position_dodge(width=0.9), hjust=-0.05, size=2.5)+ theme(axis.title.x=element_blank(),axis.text.x=element_blank(),axis.ticks.x=element_blank())

```


### Number of Users per Application  
The below graph shows the number of users per a application. The aplication is the route of access to bwin.  

```{r , fig.height = 5, fig.width = 8, warning=FALSE, echo=FALSE}
apps<-data%>%
  count(Application,sort=TRUE)

ggplot(apps, aes(x=reorder(Application, n),y=n)) + geom_bar(stat='identity',fill = 'dodgerblue3') + theme_bw() + coord_flip() + scale_y_continuous("Number of Users", breaks = seq(0,23000,3000)) + labs(title = "Users by Application",x="") + theme_gray()
summary(data$Application)

```


### Number of Churners in an Application
The concentration of potential churners in an application in the form of Heat Map.

```{r, warning=FALSE, echo=FALSE}
MD <- data[is.na(data$Gender) == FALSE, ]

ggplot(MD, aes(Gender, Application))+
  geom_raster(aes(fill = ChurnRate))+
  labs(title ="", x = "Gender", y = "Application")+
  scale_fill_continuous(name = "ChurnRate")
```


### Number of Churners by Product
The next graph shows the number of potential churners in each product and by gender. We can observe that regardless of the gender the product with clients having the highest churn rate is Supertoto followed by Games VS. Otherwise, Casino games and Sports fixed-odd have the best churn rate.

```{r, warning=FALSE, echo=FALSE}
MFP <- data[is.na(data$FavProduct) == FALSE, ]
MFP <- MFP[is.na(MFP$Gender) == FALSE, ]

ggplot(MFP, aes(Gender,FavProduct))+
  geom_raster(aes(fill = ChurnRate))+
  labs(title ="", x = "Gender", y = "Product")+
  scale_fill_continuous(name = "ChurnRate")
```

### Number of clients by Loyalty category
The chart shows the total number of clients in each loyalty category.

```{r, warning=FALSE, echo=FALSE}
MD2F <- data[is.na(data$LoyaltyCategory) == FALSE,]

MD2F <- MD2F %>%
  count(LoyaltyCategory) %>%
  rename(Counts = n)

ggplot(MD2F, aes(LoyaltyCategory, Counts)) + geom_bar(stat = "identity", fill = 'dodgerblue3') + scale_x_discrete("") + theme(axis.text.x = element_text(vjust = 0.5)) + geom_text(aes(x=LoyaltyCategory, y=Counts,label=Counts), position=position_dodge(width=1), vjust=-0.5, size=3)

```


### Total Revenue per Loyalty Category
The chart shows the total revenue to the company from the loyalty categories.
```{r, warning=FALSE, echo=FALSE}
MD2 <- data[is.na(data$LoyaltyCategory) == FALSE,]

MD2 <- MD2 %>%
  group_by(LoyaltyCategory) %>%
  summarise(TotalRevenue = sum(GGR))

ggplot(MD2, aes(LoyaltyCategory, TotalRevenue)) + geom_bar(stat = "identity", fill = "darkblue") + scale_x_discrete("Loyalty Category") + theme(axis.text.x = element_text(vjust = 0.5)) + labs(title = "") + scale_y_continuous(labels = scales::comma) + geom_text(aes(x=LoyaltyCategory, y=TotalRevenue,label=TotalRevenue), position=position_dodge(width=1), vjust=-0.5, size=3)
```

### Poker Activity
The pie chart shows the number of users not having poker activity.

``` {r, warning=FALSE, echo=FALSE }

d <- data%>%
  group_by(Gender,PokerActivity) %>%
  count(Gender) %>%
  rename(Counts = n) %>%
  group_by(PokerActivity) %>%
  summarise(Users = sum(Counts)) %>%
  na.omit()

d$PokerActivity <- ifelse(d$PokerActivity == 0,"Inactive","Active") 

d <- data.frame(d)
print(d)

ggplot(d, aes(x="", y=Users, fill=PokerActivity))+
geom_bar(width = 1, stat = "identity") + coord_polar("y", start=0) + scale_fill_brewer(palette="Blues") +
  theme(axis.text.x=element_blank())

```


# Variable Definitions
***
## Key Variables

**UserID**  
**Gender**  
**RegDate** - Registration Date   
**FirstPay** - First pay in Date  
**Country**  
**Language**  
**Application** - Application used by the Client   
**Age**  
**FavProduct** - User's favourite product derived from FavProductbets   
**TotalStakes** - Total money bet by the Client   
**TotalWinnings** - Total money won by the Client  
**FavProductbets** - Most number of bets in a product by the Client  
**TotalBets** - Total number of bets by the Client  
**FirstActivedate** - Date of the first bet  
**LastActivedate** - Date of the last bet  
**DaysSinceActive** - Number of days since the last bet  
**TotalActivedays** - Number of days client had betting activity  
**POTotalbuy** - Total amount of buys in Poker  
**POTotalsell** - Total amount of Sells in Poker  
**PODaysSinceActive** - Number of days since Last poker activity  
**POLastActivebuy** - Date of recent buy  
**POLastActivesell** - Date of recent sell  
**POTotalActivedays** - Number of days client had poker activity  
**PokerActivity** - wether client has poker activity 1 = Active, 0 = Inactive 


 

